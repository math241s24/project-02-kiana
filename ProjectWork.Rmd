
#Workspace for Project 2

```{r}
library(readr)
library(tidyverse)
library(tidycensus)
library(flextable)
library(sf)
library(tigris)
library(tmap)
library(RColorBrewer)
library(countdown)
library(gt)
library(readxl)
library(gganimate)
library(gifski)
library(knitr)
library(kableExtra)
library(transformr)
library(ggtext)
```

#bringing over clean data 
- fires_sf (fire spatial data)
- ca_sf (county spatial data)
- fire_manage (merged fire and land management data)
- fire_county (merged fire and county data)
```{r}
fires_sf <- readRDS('Data/fires_sf.rds')
fires_sf$discover_yr <- factor(fires_sf$discover_yr)
ca_sf <- readRDS('Data/ca_sf.rds')
fires_manage <- readRDS('Data/fires_manage.rds')
fires_county <- readRDS('Data/fires_county.rds')
fires_county_grp <- readRDS('Data/fires_county_grp.rds')
county_fire_stats <- readRDS('Data/county_fire_stats.rds')

```


Initial mapping of datasets independently:
- these take forever to load omg
```{r}
#map of management levels across california: federal, state, local, tribal etc
#ggplot() +
#  geom_sf(data = PAD_CA_sf, aes(fill = mang_level)) +
#  labs(fill = "Management Level") +
#  theme_void()

#map of county boundaries in CA
ggplot() +
  geom_sf(data = ca_sf, aes(fill = NAME), show.legend = FALSE) +
  labs(fill = "County") +
  theme_void() 

#map of fires in CA: colored by year
ggplot() +
  geom_sf(data = fires_sf, aes(fill = factor(discover_yr))) +
  labs(fill = "Year") +
  scale_fill_manual(values = rainbow(length(unique(fires_sf$discover_yr)))) +
  theme_void()
```

Justifying Management -> County:

Considering percentage of total acres managed by each level
```{r, eval = FALSE}
#absolutely can not push this dataset rip
PAD_CA_sf <- readRDS('Data/PAD_CA_sf.rds')
total_acres <- sum(PAD_CA_sf$GIS_Acres, na.rm = TRUE)

area_summary <- PAD_CA %>%
  group_by(mang_level) %>%
  summarise(total_area = sum(GIS_Acres),
            percentage = (sum(GIS_Acres) / total_acres) * 100) %>%
  arrange(desc(total_area))  # Optional: Arrange by total_area in descending order

print(area_summary)

#piechart visualization of management level
pie_landmang_perclands <- ggplot(area_summary, aes(x = "", y = percentage, fill = mang_level, label = paste0(round(percentage), "%"))) +
  geom_bar(stat = "identity", width = 1) +
  geom_text(position = position_stack(vjust = 0.5), aes(x = 1.55), color = "black", size = 3) +
  coord_polar("y", start = 0) +
  labs(title = "Public Lands Management:",
       subtitle = "Percentage of Public Lands Each Jurisdiction Manages",
       fill = "") +
  theme_void() +
  theme(legend.position = "bottom") +
  scale_fill_brewer(palette = "Set2")

ggsave("pie_landmang_perclands.png", pie_landmang_perclands, width = 10, height = 10, units = "in")
```
Results:
mang_level                    total_area percentage
  <chr>                              <dbl>      <dbl>
1 Federal                         84464295     91.4  
2 State                            3304552      3.58 
3 Local Government                 2128048      2.30 
4 Non-Governmental Organization    1816762      1.97 
5 American Indian Lands             673302      0.729


```{r}
fire_counts_manglvl <- fires_manage %>%
  group_by(mang_level) %>%
  summarize(fire_count = n()) %>%
  mutate(percentage = (fire_count / sum(fire_count)) * 100)

pie_landmang_percfires <- ggplot(fire_counts_manglvl, aes(x = "", y = percentage, fill = mang_level, label = paste0(round(percentage), "%"))) +
  geom_bar(stat = "identity", width = 1) +
  geom_text(position = position_stack(vjust = 0.5), aes(x = 1.55), color = "black", size = 3) +
  coord_polar("y", start = 0) +
  labs(title = "Wildfires on Public Lands:",
       subtitle = "Jurisdiction of public land fires from 1984-2020",
       fill = "") +
  theme_void() +
  theme(legend.position = "bottom") +
  scale_fill_brewer(palette = "Set2")

#74.3% of fires occurred on Federal Land, 510 fires
#17.4% of fires occurred on State Land, 120 fires
#nothing else of real importance
#and this is from 1984 - 2020 ... 

ggsave("pie_landmang_percfires.png", pie_landmang_percfires, width = 10, height = 10, units = "in")
```

Over Time
```{r}
fire_counts_manglvlyr <- fires_manage %>%
  group_by(mang_level, discover_yr) %>%
  summarize(fire_count = n(), total_acres = sum(total_reported_acres)) %>%
  ungroup() %>%
  group_by(discover_yr) %>%
  mutate(total_fires = sum(fire_count),
         total_acres_burnt = sum(total_acres),
         numfires_perc = round((fire_count / total_fires) * 100),
         acresfires_perc = round((total_acres / total_acres_burnt) * 100),
         avg_size = total_acres / fire_count) %>%
  ungroup()

ggplot(fire_counts_manglvlyr, aes(x = discover_yr, y = fire_count, color = mang_level)) +
  geom_line() +
  labs(title = "CA Wildfires Over Time Across Land Management Jurisdiction",
       x = "Year Discovered",
       y = "Number of Fires",
       color = "Land Management")

ggplot(fire_counts_manglvlyr, aes(x = discover_yr, y = numfires_perc, color = mang_level)) +
  geom_line() +
  labs(title = "Land Management Jurisdiction of CA Wildfires: Proportion of Fires",
       x = "Year Discovered",
       y = "Percentage of Total Fires",
       color = "Land Management")

ggplot(fire_counts_manglvlyr, aes(x = discover_yr, y = total_acres_burnt, color = mang_level)) +
  geom_line() +
  labs(title = "Land Management Jurisdiction of CA Wildfires: Acres Burnt",
       x = "Year Discovered",
       y = "Total Acres Burnt",
       color = "Land Management")

ggplot(fire_counts_manglvlyr, aes(x = discover_yr, y = avg_size, color = mang_level)) +
  geom_line() +
  labs(title = "Land Management Jurisdiction of CA Wildfires: Fire Size",
       x = "Year Discovered",
       y = "Average Size of Fires",
       color = "Land Management")
```

Animated Plot of Wildfires each year:
- without boundaries
```{r}
#Animated plot of fires_sf without any boundaries
ggplot() +
  geom_sf(data = fires_sf, aes(fill = factor(discover_yr))) +
  labs(fill = "Year") +
  theme_void() + 
  transition_states(discover_yr, 
                    transition_length = 1, 
                    state_length = 1)

```

- with county boundaries
```{r}
#animated plot of wildfires each year with county boundaries

anim_firescounties <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = fires_county_grp, aes(fill = county_name), show.legend = FALSE) +
  labs(title = "Wildfire Perimeters",
       subtitle = 'Year: {closest_state}') +
  theme_void() +
  transition_states(discover_yr, 
                  transition_length = 10, 
                  state_length = 10)

anim_save("anim_firescounties.gif", anim_firescounties, renderer = gifski_renderer(), path = "PrerenderedPlots/")

#animated plot of counties with wildfires
anim_firescounties_grp <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = county_fire_stats, aes(fill = county_name), show.legend = FALSE) +
  labs(title = "Counties Experiencing Wildfires",
       subtitle = 'Year: {closest_state}') +
  theme_void() +
  transition_states(discover_yr, 
                  transition_length = 10, 
                  state_length = 10)

anim_save("anim_firescounties_grp.gif", anim_firescounties_grp, renderer = gifski_renderer(), path = "PrerenderedPlots/")

```

Comparing Frequency and Intensity of Fires over time by County (ALL COUNTIES)
```{r}
ggplot(fires_county_grp, aes(x = discover_yr, y = fire_count, color = county_name)) +
  geom_line() +
  labs(title = "CA Wildfires across Counties: Number of Fires",
       x = "Year Discovered",
       y = "Number of Fires",
       color = "County") +
  theme(legend.position = "none", legend.title = element_blank())

ggplot(fires_county_grp, aes(x = discover_yr, y = numfires_perc, color = county_name)) +
  geom_line() +
  labs(title = "CA Wildfires across Counties: Percentage of Fires",
       x = "Year Discovered",
       y = "Percentage of Total Fires",
       color = "County")

ggplot(fires_county_grp, aes(x = discover_yr, y = total_acres, color = county_name)) +
  geom_line() +
  labs(title = "CA Wildfires across Counties: Total Acres Burnt",
       x = "Year Discovered",
       y = "Acres Burnt",
       color = "County")

ggplot(fires_county_grp, aes(x = discover_yr, y = acresfires_perc, color = county_name)) +
  geom_line() +
  labs(title = "CA Wildfires across Counties: Percentage of Total Fire Damage",
       x = "Year Discovered",
       y = "Percentage of Total Acres Burnt",
       color = "County")

ggplot(fires_county_grp, aes(x = discover_yr, y = avg_size, color = county_name)) +
  geom_line() +
  labs(title = "CA Wildfires across Counties: Average Size of Fires",
       x = "Year Discovered",
       y = "Average Size of Fires",
       color = "County")
```


Mapping ^^ 

```{r}
anim_totfires_county <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = county_fire_stats, aes(fill = fire_count), show.legend = "fill") +
  labs(title = "Wildfire Frequency",
       subtitle = 'Year: {closest_state}',
       fill = "Number of Wildfires") +
  theme_void() +
  scale_fill_gradient(low = "#ffdc6b", high = "#ad2723") +
  transition_states(discover_yr, 
                    transition_length = 10, 
                    state_length = 10)

anim_save("anim_totfires_county.gif", anim_totfires_county, renderer = gifski_renderer())


anim_percfires_county <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = county_fire_stats, aes(fill = numfires_perc), show.legend = "fill") +
  labs(title = "Wildfire Frequency",
       subtitle = 'Year: {closest_state}',
       fill = "Percentage of Yearly Wildfires") +
  theme_void() +
  scale_fill_gradient(low = "#ffdc6b", high = "#ad2723") +
  transition_states(discover_yr, 
                    transition_length = 10, 
                    state_length = 10)

anim_save("anim_percfires_county.gif", anim_percfires_county, renderer = gifski_renderer())


anim_totacres_county <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = county_fire_stats, aes(fill = total_acres), show.legend = "fill") +
  labs(title = "Total Acres Burnt",
       subtitle = 'Year: {closest_state}',
       fill = "Acres Burnt") +
  theme_void() +
  scale_fill_gradient(low = "#ffdc6b", high = "#ad2723") +
  transition_states(discover_yr, 
                    transition_length = 10, 
                    state_length = 10)

anim_save("anim_totacres_county.gif", anim_totacres_county, renderer = gifski_renderer())

anim_avgsize_county <- ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black", size = 1.2) +
  geom_sf(data = county_fire_stats, aes(fill = avg_size), show.legend = "fill") +
  labs(title = "Fire Intensity by County",
       subtitle = 'Year: {closest_state}',
       fill = "Acres Burnt/Number of Fires") +
  theme_void() +
  scale_fill_gradient(low = "#ffdc6b", high = "#ad2723") +
  transition_states(discover_yr, 
                    transition_length = 10, 
                    state_length = 10)

anim_save("anim_avgsize_county.gif", anim_avgsize_county, renderer = gifski_renderer())
```


