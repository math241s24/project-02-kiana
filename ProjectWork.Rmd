

#Workspace for Project 2

```{r}
library(readr)
library(tidyverse)
library(tidycensus)
library(flextable)
library(sf)
library(tigris)
library(tmap)
library(RColorBrewer)
```

#bringing over clean data 
- fires_sf (fire spatial data)
- ca_sf (county spatial data)
- fire_manage (merged fire and land management data)
- fire_county (merged fire and county data)
```{r}
fires_sf <- readRDS('Data/fires_sf.rds')
ca_sf <- readRDS('Data/ca_sf.rds')
fires_manage <- readRDS('Data/fires_manage.rds')
fires_county <- readRDS('Data/fires_county.rds')
```


Initial mapping of datasets independently:
- these take forever to load omg
```{r}
#map of management levels across california: federal, state, local, tribal etc
#ggplot() +
#  geom_sf(data = PAD_CA_sf, aes(fill = mang_level)) +
#  labs(fill = "Management Level") +
#  theme_void()

#map of county boundaries in CA
ggplot() +
  geom_sf(data = ca_sf, aes(fill = NAME), show.legend = FALSE) +
  labs(fill = "County") +
  theme_void() 

#map of fires in CA: colored by year
ggplot() +
  geom_sf(data = fires_sf, aes(fill = factor(discover_yr))) +
  labs(fill = "Year") +
  scale_fill_manual(values = rainbow(length(unique(fires_sf$discover_yr)))) +
  theme_void()
```

Justifying Management -> County:
<!--
Considering percentage of total acres managed by each level
```{r}
total_acres <- sum(PAD_CA$GIS_Acres, na.rm = TRUE)

area_summary <- PAD_CA %>%
  group_by(mang_level) %>%
  summarise(total_area = sum(GIS_Acres),
            percentage = (sum(GIS_Acres) / total_acres) * 100) %>%
  arrange(desc(total_area))  # Optional: Arrange by total_area in descending order

print(area_summary)

#piechart visualization  
ggplot(area_summary, aes(x = "", y = percentage, fill = mang_level, label = paste0(round(percentage), "%"))) +
  geom_bar(stat = "identity", width = 1) +
  geom_text(position = position_stack(vjust = 0.5), aes(x = 1.55), color = "black", size = 3) +
  coord_polar("y", start = 0) +
  labs(title = "Percentage of Total Acres by Management Level",
       fill = "") +
  theme_void() +
  theme(legend.position = "bottom") +
  scale_fill_brewer(palette = "Set2")
```
Results:
mang_level                    total_area percentage
  <chr>                              <dbl>      <dbl>
1 Federal                         84464295     91.4  
2 State                            3304552      3.58 
3 Local Government                 2128048      2.30 
4 Non-Governmental Organization    1816762      1.97 
5 American Indian Lands             673302      0.729
-->

```{r}
fire_counts_mangnm_yr <- fire_manage %>%
  group_by(mang_name, discover_yr) %>%
  summarize(fire_count = n()) %>%
  mutate(percentage = (fire_count / sum(fire_count)) * 100)

fire_counts_manglvl_yr <- fire_manage %>%
  group_by(mang_level, discover_yr) %>%
  summarize(fire_count = n()) %>%
  mutate(percentage = (fire_count / sum(fire_count)) * 100)

fire_counts_manglvl <- fire_manage %>%
  group_by(mang_level) %>%
  summarize(fire_count = n()) %>%
  mutate(percentage = (fire_count / sum(fire_count)) * 100)

#74.3% of fires occurred on Federal Land, 510 fires
#17.4% of fires occurred on State Land, 120 fires
#nothing else of real importance
#and this is from 1984 - 2020 ... 

ggplot(fire_counts_manglvl_yr, aes(x = discover_yr, y = fire_count, color = mang_level)) +
  geom_line() +
  labs(title = "CA Wildfires Over Time Across Land Management Level",
       x = "Year Discovered",
       y = "Number of Fires",
       color = "Land Management")
```

Animated Plot of Wildfires each year:
- currently using fires_sf so without boundaries
- create using fires_counties and add county boundaries
```{r}
library(countdown)
library(gt)
library(readxl)
library(gganimate)
library(gifski)
library(knitr)
library(kableExtra)
library(transformr)

fires_sf$discover_yr <- factor(fires_sf$discover_yr)

#Animated plot of fires_sf without any boundaries
ggplot() +
  geom_sf(data = fires_sf, aes(fill = factor(discover_yr))) +
  labs(fill = "Year") +
  theme_void() + 
  transition_states(discover_yr, 
                    transition_length = 1, 
                    state_length = 1)

```

```{r}
#animated plot of wildfires each year with county boundaries

fires_county_grp <- fires_county %>% 
  group_by(county_name, discover_yr) %>% 
  summarize(fire_count = n()) %>% 
  mutate(percentage = paste0(round((fire_count / sum(fire_count)) * 100), "%"))


ggplot() +
  geom_sf(data = ca_sf, aes(), fill = "white", color = "black") +
  geom_sf(data = fires_county_grp, aes(fill = county_name)) +
  labs(title = 'Year: {closest_state}', 
       fill = "Percentage of Fires by County") +
  guides(fill = guide_legend(label = paste(unique(fires_county$county_name),
                                           " - ", 
                                           fires_county$percentage, 
                                           "%", sep = ""))) +
  theme_void() +
  transition_states(discover_yr, 
                    transition_length = 5, 
                    state_length = 2)


```

```{r}
fires_county |>
  group_by(year) |>
  mutate(rank = order) |>
  mutate(label = paste0(county_name,' - ' ,percentage))

ggplot() +
  geom_sf(data = ca_sf, aes(), fill = NA, color = "black") +
  geom_sf(data = fires_county_grp, aes(fill = county_name)) +
  labs(title = 'Year: {closest_state}') +
  scale_fill_discrete(name = "Percentage of Fires by County", 
                      labels = paste(fires_county_grp$county_name, " - ", fires_county_grp$percentage, "%", sep = "")) +
  theme_void() +
  transition_states(discover_yr, 
                  transition_length = 5, 
                  state_length = 2)
```

Statistics and Analysis
```{r}
#fire counts by county stats
fire_counts <- fires_county %>%
  group_by(county_name) %>%
  summarize(fire_count = n()) %>%
  mutate(percentage = (fire_count / sum(fire_count)) * 100)
```


